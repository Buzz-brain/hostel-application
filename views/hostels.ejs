<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Hostel Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://ai-public.creatie.ai/gen_page/tailwind-custom.css" rel="stylesheet" />
    <script
        src="https://cdn.tailwindcss.com/3.4.5?plugins=forms@0.5.7,typography@0.5.13,aspect-ratio@0.4.2,container-queries@0.1.1"></script>
    <script src="https://ai-public.creatie.ai/gen_page/tailwind-config.min.js" data-color="#000000"
        data-border-radius="small"></script>
</head>

<body class="bg-gray-50 min-h-screen">
    <nav class="bg-white border-b border-gray-200">
        <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                    </div>
                    <div class="sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#"
                            class="border-custom text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Dashboard</a>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="relative">
                            <div class="sm:ml-6 sm:flex sm:items-center">
                                <div class="ml-3 relative">
                                    <div class="flex items-center">
                                        <span class="ml-3 text-sm font-medium text-gray-700" id="username"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </nav>
    <main class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <div class="lg:col-span-3">
                <div
                    class="bg-white shadow rounded-lg mb-8 p-6 transform transition-all duration-300 hover:scale-102 hover:shadow-lg">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Application Status</h2>
                    <div id="application-status" class="p-4 rounded-lg border">
                        <!-- Application status will be displayed here -->
                    </div>
                </div>

                <div id="application-status"></div>

                <div class="bg-white shadow rounded-lg transform transition-all duration-300 hover:shadow-lg">
                    <div class="p-6">
                        <h2 class="text-lg font-medium text-gray-900 mb-6">Hostel Application Form</h2>
                        <form id="hostel-application-form">
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Preferred Hostel</label>
                                    <select id="hostel-select"
                                        class="mt-1 block w-full !rounded-button border-gray-300 focus:border-custom focus:ring-custom transition-all duration-300 hover:border-custom">
                                        <!-- Hostels will be populated here -->
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Study Habit</label>
                                    <select id="studyHabit"
                                        class="mt-1 block w-full !rounded-button border-gray-300 focus:border-custom focus:ring-custom transition-all duration-300 hover:border-custom">
                                        <option value="withMusic">Study with Music</option>
                                        <option value="withoutMusic">Study without Music</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Sleeping Habit</label>
                                    <select id="sleepingHabit"
                                        class="mt-1 block w-full !rounded-button border-gray-300 focus:border-custom focus:ring-custom transition-all duration-300 hover:border-custom">
                                        <option value="darkRoom">Sleep in a dark room</option>
                                        <option value="lightRoom">Sleep in a bright room</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex justify-end">
                                <button type="submit"
                                    class="!rounded-button mt-3 bg-custom px-4 py-2 text-sm font-medium text-white hover:bg-custom/90 focus:outline-none focus:ring-2 focus:ring-custom focus:ring-offset-2 transform transition-all duration-300 hover:scale-105 active:scale-95">Apply
                                    for Hostel</button>
                            </div>
                        </form>
                    </div>


                </div>
            </div>
            <div class="space-y-8">
                <div class="bg-white shadow rounded-lg p-6 transform transition-all duration-300 hover:shadow-lg">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Important Dates</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Application
                                Deadline</span><span class="text-sm font-medium">June 30, 2024</span></div>
                        <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Move-in
                                Date</span><span class="text-sm font-medium">August 15, 2024</span></div>
                        <div class="flex justify-between items-center"><span class="text-sm text-gray-600">Contract
                                End</span><span class="text-sm font-medium">May 31, 2025</span></div>
                    </div>
                </div>

                <div class="bg-white shadow rounded-lg p-6 transform transition-all duration-300 hover:shadow-lg">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Need Help?</h2>
                    <div class="space-y-4">
                        <a href="#"
                            class="block text-sm text-gray-700 hover:text-custom transition-colors duration-300 transform hover:translate-x-2">
                            <i class="fas fa-question-circle mr-2"></i>
                            Frequently Asked Questions
                        </a>
                        <a href="#"
                            class="block text-sm text-gray-700 hover:text-custom transition-colors duration-300 transform hover:translate-x-2">
                            <i class="fas fa-envelope mr-2"></i>
                            Contact Hostel Administration
                        </a>
                        <div class="border-t border-gray-200 pt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">Emergency Contact</h3>
                            <p class="text-sm text-gray-500">
                                <i class="fas fa-phone mr-2"></i>
                                +1 (555) 123-4567
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="bg-white border-t border-gray-200 mt-8">
        <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-sm text-gray-500">
                © 2024 University Housing System. All rights reserved.
            </div>
        </div>
    </footer>
    <script>


        document.querySelectorAll('input[name="room-type"]').forEach(radio => {
            radio.addEventListener('change', function () {
                document.querySelectorAll('input[name="room-type"]').forEach(r => {
                    const icon = r.parentElement.querySelector('.fa-check-circle');
                    if (r.checked) {
                        icon.classList.remove('invisible');
                        r.parentElement.classList.add('border-custom', 'ring-2', 'ring-custom');
                    } else {
                        icon.classList.add('invisible');
                        r.parentElement.classList.remove('border-custom', 'ring-2', 'ring-custom');
                    }
                });
            });
        });




        // Get hostels
        const hostelSelect = document.getElementById('hostel-select');

        async function getHostels() {
            try {
                const response = await fetch('/student/hostels');
                const data = await response.json();
                const hostels = data.hostels;

                hostels.forEach((hostel) => {
                    const option = document.createElement('option');
                    option.value = hostel._id;
                    option.text = `${hostel.hostelBuilding} - ${hostel.roomNumber} (${hostel.roomType}) - ₦${hostel.amount}`;
                    hostelSelect.appendChild(option);
                });
            } catch (error) {
                console.error(error);
            }
        }

        getHostels();




        // Hostel Application
        const hostelApplicationForm = document.getElementById('hostel-application-form');
        const studyHabit = document.getElementById('studyHabit').value;
        const sleepingHabit = document.getElementById('sleepingHabit').value;

        const user = document.getElementById('username')
        user.innerText = localStorage.getItem('username');

        hostelApplicationForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const studentId = localStorage.getItem('userId');

            const hostelId = hostelSelect.value;

            console.log(studyHabit)
            console.log(sleepingHabit)

            try {
                const response = await fetch('/student/apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ studentId, hostelId, studyHabit, sleepingHabit, })
                });

                const data = await response.json();
                console.log(data);
                alert('Application submitted successfully!');
            } catch (error) {
                console.error(error);
                alert('Error submitting application');
            }
        });

    const applicationStatusDiv = document.getElementById('application-status');




    async function getApplicationStatus() {
        try {
            const studentId = localStorage.getItem('userId');
            const response = await fetch(`/student/application-status?studentId=${studentId}`);
            const data = await response.json();
            if (data.message === 'Application not found') {
                applicationStatusDiv.innerHTML = 'No application yet';
                applicationStatusDiv.classList.add('text-gray-700', 'text-sm', 'font-medium', 'p-4');
            } else {
                const status = data.status;
                let backgroundColor, textColor, iconClass, message;
                switch (status) {
                    case 'Approved':
                        backgroundColor = 'bg-green-50';
                        textColor = 'text-green-800';
                        iconClass = 'fas fa-check-circle text-green-400';
                        message = 'Congratulations! Your hostel application has been approved. Please proceed with the room selection and payment process.';
                        break;
                    case 'Pending':
                        backgroundColor = 'bg-yellow-50';
                        textColor = 'text-yellow-800';
                        iconClass = 'fas fa-clock text-yellow-400';
                        message = 'Your hostel application is currently pending review. Please check back later for updates.';
                        break;
                    case 'Rejected':
                        backgroundColor = 'bg-red-50';
                        textColor = 'text-red-800';
                        iconClass = 'fas fa-times-circle text-red-400';
                        message = 'Sorry, your hostel application has been rejected. Please contact the administration for more information.';
                        break;
                    default:
                        backgroundColor = 'bg-gray-50';
                        textColor = 'text-gray-800';
                        iconClass = 'fas fa-question-circle text-gray-400';
                        message = 'Unknown application status. Please contact the administration for more information.';
                }
                applicationStatusDiv.innerHTML = `<div class="flex"> <div class="flex-shrink-0"> <i class="${iconClass}"></i> </div> <div class="ml-3"> <h3 class="text-sm font-medium ${textColor}">Application ${status}</h3> <p class="mt-2 text-sm text-gray-700">${message}</p> </div> </div>`;
                applicationStatusDiv.classList.add(backgroundColor);
                applicationStatusDiv.classList.add('border', 'border-gray-200', 'rounded-lg', 'p-4');
            }
        } catch (error) {
            console.error(error);
        }
    }

    getApplicationStatus();








// async function getStatus(studentId) {
//         const response = await fetch(`/student/application-status?studentId=${studentId}`);
//         const data = await response.json();

//         const statusDiv = document.getElementById('application-status');
//         statusDiv.innerHTML = `Status: ${data.status}`;
//         if (data.roommate) {
//             statusDiv.innerHTML += `<br>Matched with: ${data.roommate}`;
//         }
//     }

    // Call the function with the logged-in student's ID
    // getStatus('12345'); // Replace '12345' with the actual student ID

    </script>